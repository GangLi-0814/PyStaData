## 8. 自相关

### 8.1 自相关的后果

违反球形扰动项的另一情形是**扰动项存在自相关**。

对于扰动项 $\{\epsilon_1,\cdots,\epsilon_n\}$ ，如果存在 $i \neq j$，使得 $E(\epsilon_i\epsilon_j | X) \neq 0$ ，即协方差矩阵 $Var(\epsilon|X)$ 的非主对角线元素不全为 0 ，则存在“自相关”或“序列相关”。

在自相关的情况下：

- OLS 估计量依然无偏、一致且渐近正态，因为证明这些性质时，并未用到“无自相关”的假定。
- OLS 估计量方差 $Var(\hat \beta | X)$ 的表达式不再是 $\sigma^2(X'X)^{-1}$ ，因为 $Var(\epsilon|X) \neq \sigma^2I$ 。使用普通标准误的 t 检验、F 检验失效。
- 高斯-马尔可夫定理不再成立，OLS 不再是 BLUE 。

假设扰动项存在正自相关，即 $E(\epsilon_i\epsilon_j|X) > 0 $，则如下图：

<img src="/Users/gangli/PyStaData/PhD/Econometrics/陈强-计量经济学及Stata应用/images/8-1.png" style="zoom:60%;"/>

实线表示真实的总体回归线。

如果 $\epsilon_1 > 0$ ，由于扰动项存在正自相关，则 $\epsilon_2 > 0$ 的可能性也很大。如果 $\epsilon_{n-1} < 0$ ，则 $\epsilon_n < 0$ 的可能性也就很大。 样本回归线（虚线）很可能左侧翘起、右侧下垂，使得对回归线斜率的估计过小。

反之，如果 $\epsilon_1 < 0$，由于扰动项存在正自相关，故 $\epsilon_2 < 0$ 的可能性也很大。如果 $\epsilon_{n-1} > 0$ （图中右边小圆点），则 $\epsilon_n > 0$ 的可能性也就很大。 样本回归线（虚线）很可能左侧下垂、右侧翘起，使得对回归线斜率的估计过大。

由于自相关的存在，使得样本回归线上下摆动幅度增大，导致参数估计变得不准确。从信息角度，由于 OLS 估计忽略了扰动项自相关所包含的信息， 故不是最有效率的估计方法。

### 8.2 自相关的例子

（1）时间序列：由于经济活动通常具有连续性或持久性，自相关在时间序列中较常见。例如：

- 相邻两年的 GDP 增长率、通货膨胀率。 
- 某意外事件或新政策的效应需要随时间逐步释放出来。
- 最优资本存量需要通过若干年的投资才能逐渐达到(滞后的调整过程)。

（2）横截面数据：截面数据不易出现自相关，但相邻的观测单位 之间也可能存在“溢出效应”(spillover effect 或 neighborhood effect)，这种自相关也称为“空间自相关”(spatial autocorrelation)。例如：

- 相邻的省份、国家之间的经济活动相互影响(通过贸易、投 资、劳动力流动等）。
- 相邻地区的农业产量受到类似天气变化的影响。
- 同一社区内的房屋价格存在相关性。


（3）对数据的人为处理：如果数据中包含移动平均数(moving average)、内插值或季节调整时，可从理论上判断存在自相关。

统计局提供的某些数据可能事先经过了人为处理。


（4） 设定误差(misspecification)：如果模型设定中遗漏了某个自 相关的解释变量，并被纳入到扰动项中，会引起扰动项的自相关。

### 8.3 自相关的检验

#### 8.3.1 画图

由于残差 $\{e_t\}_{t=1}^n$ 可大致视为扰动项的实现值 $\{e_{t}\}_{t=1}^n$ ，故可通过残差来考察扰动项的自相关。

一个直观的方法是将 $e_t$ 与残差滞后 $e_{t-1}$ 画成散点图。

也可以计算残差的各阶样本相关系数。比如残差的一阶相关系数 $\hat \rho_1$ ，二阶相关系数 $\hat \rho_2$ ，乃至 $k$ 阶相关系数 $\hat \rho_k$ 。

相关系数 $\hat \rho_k$ 是滞后阶数 $k$ 的函数，将 $(k, \hat \rho_k)$ 画图，可得残差的自相关图。

<img src="/Users/gangli/PyStaData/PhD/Econometrics/陈强-计量经济学及Stata应用/images/8-6.png" style="zoom:60%;"/>

#### 8.3.2 BG 检验（Breusch, 1978; Godfrey, 1978）

#### 8.3.3 Q 检验

#### 8.3.4 DW 检验（Durbin and Watson， 1950）

### 8.4 自相关的处理

#### 8.4.1 使用“OLS + 异方差自相关稳健的标准误”

#### 8.4.2 准差分法

#### 8.4.3 广义最小二乘法（GLS）

#### 8.4.4 修改模型设定

### 8.5 处理自相关的 Stata 命令及实例

#### 8.5.1 时间序列算子

#### 8.5.2 画残差图

#### 8.5.3 BG 检验

#### 8.5.4 Q 检验

#### 8.5.5 DW 检验

#### 8.5.6 HAC 稳健标准误

#### 8.5.7 处理一阶自相关的 FGLS